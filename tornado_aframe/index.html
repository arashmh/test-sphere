<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>The Living Plasma Vortex • A-Frame</title>
    <meta name="description" content="The Living Plasma Vortex • A-Frame" />
    <script type="importmap">
      {
        "imports": {
          "aframe": "https://aframe.io/releases/1.7.0/aframe.module.min.js",
          "three": "https://cdn.jsdelivr.net/npm/super-three@0.173.4/build/three.module.js",
          "three/addons/": "https://cdn.jsdelivr.net/npm/super-three@0.173.4/examples/jsm/",
          "smart-height-adjuster": "./smart-height-adjuster.js",
          "tornado": "./tornado.js",
          "start-button": "./start-button.js",
        "marker": "./marker.js",
        "intersection-marker": "./intersection-marker.js",
        "play-on-start": "./play-on-start.js",

          "handy-controls": "https://cdn.jsdelivr.net/npm/handy-work/build/handy-controls.min.js",
          "sphere-collider": "https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/components/sphere-collider.min.js",
          "aframe-extras-controls": "https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/aframe-extras.controls.min.js",
          "lil-gui": "https://unpkg.com/lil-gui@0.19.1/dist/lil-gui.esm.min.js"
        }
      }
    </script>
    <script type="module">
      import AFRAME from 'aframe';
      import "sphere-collider";
      import "aframe-extras-controls";
      import "handy-controls"; 
      import 'smart-height-adjuster';
      import 'tornado'; 
      import 'start-button'; // Import the new component
         import 'marker'; // Import the marker component
          import 'intersection-marker'; // Import the new component
            import 'play-on-start'; 



    </script>
  </head>
  <body>
    <!-- 
       Attached start-button to the scene. 
       background matches Three.js black.
       fog matches Three.js settings.
    -->
    <a-scene 
        start-button="fade_in_time: 2000"
        background="color: #000000" 
        fog="type: exponential; density: 0.02; color: #000000" 
        xr-mode-ui>

    <!-- assets -->
        <a-assets>
            <audio id="shell" src="./assets/sounds/shell.mp3"></audio>
            <audio id="background" src="./assets/sounds/background.mp3"></audio>
            <audio id="underwater" src="./assets/sounds/underwater.mp3"></audio>
        </a-assets>
      
      <!-- The Living Plasma Vortex -->
      <a-entity id="tornado" tornado
                marker="camera: #head; show_hud: true;" 
                 position="0 0 -7">

                 <!-- sound for tornado-->
        <a-entity
                position="0 15 0"
                sound="src: #background; 
                 autoplay: false; 
                 loop: true; 
                 volume: 1;
                 distanceModel: exponential;"
        play-on-start
></a-entity>

        <!-- underwater ambient sound  -->
        <a-entity
                position="0 1.8 0"
                sound="src: #underwater; 
                 autoplay: false; 
                 loop: true; 
                 volume: 0.3;
                 distanceModel: exponential;
                 refDistance: 0.1;
                 rolloffFactor: 2;"
        play-on-start
></a-entity>

        </a-entity>

    <!-- entity at intersection with child sound -->
    <a-entity id="intersection-marker" intersection-marker="position_event_entity:#tornado">
        <a-entity 
      sound="src: #shell; 
                 autoplay: false; 
                 loop: true; 
                 volume: 1;
                 distanceModel: exponential;
                 refDistance: 0.1;
                 rolloffFactor: 2;"
        play-on-start
></a-entity>
    </a-entity>

      <!-- Camera Rig -->
      <a-entity id="cameraRig" position="0 0 0" movement-controls="enabled: true; speed: 0.2; camera:#head;"
              smart-height-adjuster="
                 targetHeight: 1.8; 
                 threshold: 1.55; 
                 interval: 5000;
                 sitting_to_standing_threshold_for_readjustment: 0.4">
      
           <a-entity id="camera-height-adjuster" position="0 0 0">
              <a-entity id="head" camera="active: true" look-controls position="0 1.75 0"></a-entity>
              <a-entity id="hands" handy-controls="renderGamepad: any; materialOverride: both;" material="color: #FFDB58; metalness: 0.5; roughness: 0.3;"></a-entity>
           </a-entity>
      </a-entity>
    </a-scene>
  </body>
</html>